---
title: "Improving smallholder farmers' income through intercropping rubber and black pepper: A case study of Jhapa, Nepal"
author: "Norina Murtaza, Peter Asare-Nuamah, Aditi Bista, Heidi Hoffmann, Kalu Onyinyechi, Dorcas Sanginga"
date: "2023-07-09"
output: bookdown::html_document2:
      theme: cerulean
      toc: true
      toc_float: true
      toc_depth: 2
      number_sections: true
      number_figures: true

bibliography: 
  - bib/references.bib 
  - bib/packages.bib

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(decisionSupport)
library(readr)
```


# HowTo: Croff-References of Tables and Figures
1. Copy the BibTex code of the reference into the bib/references textfile in the repository
2. insert the ```{asis, echo=FALSE}``` option in the r-chunk where you want to cite (see example below).
3. Citation: see example

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

For citing: Figure - \@ref(fig:name) , Table - \@ref(tab:table)

i.e. \@ref(tab:input table)


# HowTo: References 
In-text references: ```[@R-<shorturl as stated in the bibtex file>]``` i.e. The [@decisionSupport] package
was used to conduct the MC simulation as well as the NPV and VoI calcutations.


```{r, add_packages_bib, include=FALSE}
knitr::write_bib(c(.packages(),
                   'decisionSupport', 'DiagrammeR'), 'bib/packages.bib')

```


# **Overview**

Rubber plant (Hevea brasiliensis) is a perennial crop and the natural source of rubber which is used in the production of a variety of products (Fox & Castella, 2013; Pandey et al., 2020). Natural rubber farming is a safe and affordable alternative to synthetic rubber production. 

In recent decades, Nepal has experienced a huge trade deficit between the import and export of rubber and rubber-related products, and at the same time, their consumption exceeds production (Pandey et al., 2020; CIFOR-ICRAF, 2022).Furthermore, as rubber plants start yielding from six to seven years after planting and, onwards, there is a need to diversify the system to enable farmers to generate income before rubber attains its maturity stage. 

Black pepper (Piper nigrum L.) is a valuable crop which could be suitable for this agronomic intervention but could also improve farmers livelihoods and lower their dependency on the international market/price fluctuation of rubber. 

Intercropping black pepper and rubber capitalizes on their complementary growth patterns and could potentially improve the ecological and financial advantages of rubber farming. Black pepper, a vine-like plant, thrives in the shade provided by the rubber trees, utilizing the vertical space and reducing weed competition [REFERENCE]. Rubber trees, on the other hand, benefit from the protection provided by the pepper vines which act as a natural windbreak and provide a microclimate conducive to rubber growth [REFERENCE].

Nepal, being a country known for its diverse agro-climatic conditions, offers a favorable environment for intercropping rubber with black pepper, a system that could maximize productivity and economic returns if planted in a well-planned agroforestry system.

## Current Situation of Rubber Production in Nepal
Nepal's climate and land slope make natural rubber cultivation ideal for addressing issues such as underemployment, underutilization of land, and poverty. However, rubber monocropping poses several challenges for farmers, including a lack of income during the long immature period, vulnerability to price shocks, seasonality, disease outbreaks, and natural disaster (DERAF report, 2020). There is a high level of rubber and pepper imports because of tight supply conditions in Nepal (Economic times, 2020). To overcome these obstacles there is a need to promoting rubber agroforestry practices especially with compatible and mutual beneficial crop species. 

## Why Rubber and Black Pepper Agroforestry system
Integrating black pepper and Rubber in an agroforestry system can offer a solution to improve food security, increase farmers' income, and enhance their livelihoods (Rahman et al., 2012). Intercropping rubber with black pepper enables smallholders to diversify their income sources and optimize land utilization during the initial six years it takes for rubber trees to become productive (Pepper Hub _YEAR_). Additionally, shading black pepper with rubber trees creates favorable growth conditions, including decreased irradiance and temperature, increased relative humidity, and higher leaf expansion, demonstrating adaptation to low light (Oleosio et al., 2021).

## Decision Problem
To improve income and the livelihoods of farmers in Nepal farmers might want to adopt rubber agroforestry practices, specifically intercropping black pepper with rubber, as an alternative to rubber monocropping. Farmers' decisions are influenced by factors such as;
1. Economic Impact: This assesses the potential income generation and economic viability of rubber intercropping practices compared to rubber monocropping, considering factors such as yield, market demand, price stability, and income diversification opportunities. 
2. Risk and Resilience: focuses on assessing the vulnerability of rubber intercropping systems to price shocks, disease outbreaks, natural disasters, and other risks, while identifying strategies to mitigate them. 
3. Policy and Market Support: Involves the evaluation of existing policies, incentives, and market linkages to facilitate the adoption of rubber intercropping systems, addressing any barriers and gaps. 
4. Cost-Benefit Analysis: This focuses on a comprehensive cost-benefit analysis, comparing the economic, environmental, and social benefits of rubber intercropping systems with rubber monocropping.
5. Technical knowledge and support: This considers whether farmers have access to technical knowledge and support. This includes understanding the agronomic practices, pest and disease management, harvesting, processing, and marketing strategies for both crops. Training programs, extension services, and collaboration with agricultural experts can help address these knowledge gaps.

## Decision
Should farmers intercrop rubber and black pepper?

## Alternatives
1. Alternative 1: Promote Rubber monocropping 
2. Alternative 2: Promote Rubber and Black Pepper intercropping

## Decision Maker
The decision makers for this project are the smallholder rubber farmers in Jhapa, Nepal. The ultimate goal is to improve their income and livelihoods.

# **Methods**

## Conceptual model
A conceptual model depicting the influence of rubber and black pepper intercropping system costs, benefits and risks on Net Present value (NPV) was developed by the project group members who acted as the stakeholders. The total cost comprised of establishment cost and maintenance cost, while total benefits comprised of natural and financial benefits. Lack of technical knowledge, water competition and economic fluctuation were the major risks identified. Economic fluctuation was however considered as a variating variable in the price. A discount rate of 10% was chosen to calculate the Net Present Value.This conceptual model guided the development of the mathematical model. 

```{r conceptual_model, out.width='100%', fig.align='center', fig.cap="Conceptual Model", echo=FALSE}

#knitr::include_graphics('results/conceptual_model.png')
#ADD png of model

```

## Input estimates
Project group members who were calibrated in the decision analysis course were the experts. We used similar scenario from a literature search and some exchange with farmers in Nepal to generated input estimates with 90% confidence.


```{r input_table, caption= "Input variables", echo=FALSE, warning=FALSE}
library(knitr)
options(scipen = 999)

input_estimates <- read.csv("./data/AF_input_table.csv", header = TRUE, sep = ";")

##input_estimates = subset(input_estimates, select = -c(median))
#kable(input_estimates[2:7])
``` 

## Assumption

Since Black Pepper grows best within moist climate, its cultivation usually requires irrigation. The climate of Eastern Nepal is marked by the annual Monsoon and long dry seasons during winter. Thereby, especially the winter months are crucial to achieve high yields, and often, Pepper plants need to be irrigated. _[This knowledge was obtained by a fast literature research, Aditi and Team Report can you correct false facts if you humble over such? - Heidi]_ 
We assumed that growing Black Pepper next to Rubber trees could either mitigate irrigation requirements as the rubber's shadow would increase the moisture, or amplify them as the roots in the topsoil could compete for water and both crops would produce smaller harvests.
Additionally, it is reported that litterfall releases high amounts of primary macronutrients such as Nitrogen, Phosphorous, and potassium (NPK) back into the soil. Estimating how much each system recycles will help to determine the profitability and sustainability of the studied systems in regard to nutrient cycling and minimize fertilization inputs in the following cropping systems.

## Code
We used the *decisionSupport* package [@R-decisionSupport] to build the mathematical model and for probabilistic analysis.

### Variating variables
Every variable calculated with vv() function since variable will vary during the 25 years of the intervention. 

### Chance events
Risks were calculated with chance_event() function which models the possibility of that event happening during the simulated time. 

### Model function which will be used to run the montecarlo simulation

```{r, echo=T, warning=F}
library(decisionSupport)

# Read data----
table <- read.csv("./data/AF_input_table.csv", sep = ";")
str(table) # to check whether reading data was successful


# Model function----

system_benefit <- function(x, varnames) {

## Natural benefits ----
 # Nutrient cycling (from litterfall)

mono_nutrient <- vv(var_mean = mono_nutrient,
                            var_CV = var_mono_nutrient,
                            n = n_years) 

mono_nutrient_saved <- mono_nutrient* fertilizer_price  #Monetary value of NPK fertilizer bags saved in rubber monoculture

AF_nutrient <- vv(var_mean = AF_nutrient,
                            var_CV = var_AF_nutrient,
                            n = n_years)

AF_nutrient_saved <- AF_nutrient * fertilizer_price  #Monetary value of NPK fertilizer bags saved in rubber and pepper system  


## Yields----
 # Scenarios
  ### As it is not known yet, the moist microclimate underneath the rubber trees can result in higher 
  ### pepper yields or, on the other hand, competition of the roots might lead to lower yields of both crops
  water_competition <- chance_event(water_competition_probability, value_if = 1, value_if_not = 0)
  
  ### Account for risk in diminished yields due to knowledge gaps especially at the initial phase
  ### and risk of knowledge gaps that could also lead to lower yields
  management_errors <- vv(var_mean = knowledge_gap_probability, var_CV = var_knowledge_gap_probability,
                          n = n_years, relative_trend = - 10)
  
  # Yield incomes
  rubber_yield <- vv(var_mean = max_rubber_yield, var_CV = var_rubber_yield, n = n_years)
  rubber_yield <- rubber_yield * (1 - management_errors) * (1 - water_competition * yield_if_competition)
  rubber_income <- rubber_yield * rubber_price
    
  pepper_yield <- vv(var_mean = max_pepper_yield, var_CV = var_pepper_yield, n = n_years)
  pepper_yield <- pepper_yield * (1 - management_errors)* (1 - water_competition * yield_if_competition)
  pepper_income <- pepper_yield * pepper_price
  

## Summarize benefits
  rubber_benefit <- rubber_income + mono_nutrient_saved
  AF_benefit <- pepper_income + rubber_income + AF_nutrient_saved
  

## Costs----
  ### Establishment costs in first year
  establistment_cost_mono <- c(establishment_cost_mono, rep(0, n_years))
  establistment_cost_AF <- c(establishment_cost_AF, rep(0, n_years))
  
  maintenance_cost_mono <- vv(var_mean = rubber_main_cost, var_CV = var_rubber_main_cost,
                              n = n_years)
  maintenance_cost_pepper <- vv(var_mean = pepper_main_cost, var_CV = var_pepper_main_cost,
                              n = n_years)
  
  
  ### Water costs
  ### pepper needs to be irrigated which is an addition cost.
  price_water <- vv(cost_water, var_cost_water, n_years)
  
  if (water_competition) {
    AF_water <- vv(mean_AF_water, var_AF_water, n_years)
  } else {
    AF_water <- vv(competition_AF_water, var_AF_water, n_years)
  }
    
  cost_AF_water <- AF_water * price_water
  
  
  ## Substracting the costs to get final benefits----
  
  ###Mono rubber final benefits
  final_income_mono <- rubber_benefit - (maintenance_cost_mono + establishment_cost_mono)
    
  ### Rubber intercropping final benefits
  final_income_AF <- AF_benefit - (establishment_cost_AF + maintenance_cost_pepper
                                                   + maintenance_cost_mono + cost_AF_water)

  ###Trade off benefits and cashflow
tradeoff_benefit <- final_income_AF - final_income_mono

cashflow <- discount(final_income_AF, discount_rate = discount_rate, calculate_NPV = FALSE)

cumul_cashflow <- cumsum(cashflow) #cumulative cashflow over 25 years

  ### NPV 
NPV_mono <- discount(final_income_mono, discount_rate = discount_rate, calculate_NPV = TRUE) #for rubber monoculture

NPV_tradeoff <- discount(tradeoff_benefit, discount_rate = discount_rate, calculate_NPV = TRUE) #for the decision 
  
NPV_AF <- discount(final_income_AF, discount_rate = discount_rate, calculate_NPV = TRUE) #for rubber and pepper
  
  return(list(cashflow= cumul_cashflow,NPV_decision= NPV_tradeoff,
              NPV_rubber= NPV_mono, NPV_AF= NPV_AF))
}

```


# **Results and Discussion**

##**Montercarlo simulation** 
This generates all possible outcomes of our interventions.

``` {r}
AF_mc_simulation <- mcSimulation(as.estimate(table),
                                         model_function = system_benefit,
                                         numberOfModelRuns = 1000,
                                         functionSyntax = "plainNames")
write.csv(AF_mc_simulation, "./results/mc_simulation_results.csv")

```

##**Plotting the Net Presnt Value (NPV)**
Plotting the NPV shows the outcome distribution of the different alternatives or/and of the decision, based on the montercarlo simulation results. The distribution plots generate an overlay economic output of the decision option.

```{r}
## NPV distribution as histogram
plot_distributions(mcSimulation_object = AF_mc_simulation,
                  vars = c("NPV_rubber", "NPV_AF"),
                  method = 'smooth_simple_overlay',
                  colors = c("#0000FF","#F0E442"),
                  base_size = 10)

## NPV distribution as boxplot
plot_distributions(mcSimulation_object = AF_mc_simulation,
                  vars = c("NPV_rubber", "NPV_AF"),
                  method = 'boxplot',
                  colors = c("#0000FF","#F0E442"),
                  base_size = 10)

## Value of the decision 
plot_distributions(mcSimulation_object = AF_mc_simulation,
                  vars = "NPV_decision",
                  method = 'smooth_simple_overlay',
                  base_size = 10)

```

## **Cashflow analysis**
This generates the monetary benefits trend during the simulated intervention period

```{r}
cashflow <- plot_cashflow(mcSimulation_object = AF_mc_simulation,
                          cashflow_var_name = "cashflow",
                          x_axis_name = "Years of intervention",
                          y_axis_name = "Cashflow in Nepali Rupee",
                          color_25_75 = "grey",
                          color_5_95 = "yellow",
                          color_median= "red",
                          base= 10)

cashflow

```

## **Sensitivity analysis (PLS)**
In this part, we run a post_host analysis using the partial least square regression (PLS).This generated
the projection score (VIP). The VIP score shows the variables to which the model is more sensitive either positively(green) or negatively(red); and which could possibly have a high impact on the outcome of the decision.
A threshold of 0.8 was given, hence any variable with a VIP score above 0.8 was considered important.

```{r}
###To get names of elements on list y and x 
names(AF_mc_simulation$x)
names(AF_mc_simulation$y)

### VIP scores
pls_results <- plsr.mcSimulation(object = AF_mc_simulation,
                                 resultName = "NPV_decision",
                                 ncomp = 1)

### Cut off at 0.8
plot_pls(pls_results, threshold = 0.8, input_table = input_estimates)


### Cut off at 0 to appreciate the impact of most of our variables on the outcome
plot_pls(pls_results, threshold = 0, input_table = input_estimates)



```

## **Value of information (VoI) analysis**
This analysis is crucial since it informs the decision-maker how much he/she should pay to reduce uncertainities and avoid opportunity loss. 

```{r}

mcresults_table <- data.frame(AF_mc_simulation$x,
                          AF_mc_simulation$y[26:28])

evpi<- multi_EVPI(mc= mcresults_table,
                  first_out_var = "NPV_decision", write_table = FALSE, outfolder = ./results/evpi_results)


plot_evpi<-plot_evpi(evpi,
          decision_vars = "NPV_decision",
          new_name= "Rubber and black pepper",
          unit= "NPR",
          bar_color= "yellow4",
          base_size=10)

plot_evpi

```

##**Compound figures**
This is a simple function/code of the entire process

```{r}
compound_figure(model = system_benefit, 
input_table = table, 
decision_var_name = "NPV_decision",
cashflow_var_name = "cashflow",
model_runs = 1000,
distribution_method = 'smooth_simple_overlay')
```



# **Conclusion**
This analysis reports the NPV difference of rubber monoculture versus rubber and black pepper intercropping. Based on our own estimates, the Monte Carlo results show that rubber and black pepper intercropping is likely to lead to a loss which is also seen on the cashflow chart.

Our model was more sensitive to the price of water, maximum pepper yield as well as the probability of water competition in the intercropping system, due to their high VIP score. This indicates that there is need for further research on those variables in order to reduce uncertainities and make an informed decision.

#**References**